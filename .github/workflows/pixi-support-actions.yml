name: Run STUMPY Tests with Pixi
on:
  workflow_dispatch:
jobs:
  test_with_pixi:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
    environment: PIXI_API_ACCESS

    steps:
      - name: Checkout STUMPY
        uses: actions/checkout@v4
        with:
          repository: stumpy-dev/stumpy
    
      - name: Set Up Pixi
        uses: prefix-dev/setup-pixi@v0.9.4
        with:
          log-level: vvv
          pixi-version: v0.62.2

          cache: false
          auth-host: prefix.dev
          auth-token: ${{ secrets.PREFIX_DEV_TOKEN }}

      - name: Install STUMPY And Other Dependencies with Pixi
        run: pixi install
        shell: bash

      - name: Show Full Numba Environment
        run: python -m numba -s
        shell: bash
        
      - name: Unit Tests
        run: pixi run ./test.sh 
        shell: bash
